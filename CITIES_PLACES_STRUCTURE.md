# üìç –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ä–æ–¥–æ–≤ –∏ –º–µ—Å—Ç –≤ Firebase

## –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–í—Å–µ —Ñ–∞–π–ª—ã **–≥–æ—Ä–æ–¥–æ–≤ —Å –º–µ—Å—Ç–∞–º–∏ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è** —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ **Firebase**, –∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ JSON —Ñ–∞–π–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ Firebase

### 1. –ì–æ—Ä–æ–¥–∞ (`cities/`)
```
firebase:
cities/
‚îú‚îÄ‚îÄ –ú–æ—Å–∫–≤–∞: { id: 1, name: "–ú–æ—Å–∫–≤–∞", photoUrl: "...", places: [{ ... }] }
‚îú‚îÄ‚îÄ –°–ü–±: { id: 2, name: "–°–ü–±", photoUrl: "...", places: [{ ... }] }
‚îî‚îÄ‚îÄ –í–∞–ª–µ–Ω—Å–∏—è: { ... }
```

### 2. –ú–µ—Å—Ç–∞ –≤ –≥–æ—Ä–æ–¥–µ (`places/`)
```
firebase:
places/
‚îú‚îÄ‚îÄ –ú–æ—Å–∫–≤–∞:
‚îÇ   ‚îú‚îÄ‚îÄ place_1: { id: "...", name: "–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å", category: "..." }
‚îÇ   ‚îú‚îÄ‚îÄ place_2: { ... }
‚îÇ   ‚îî‚îÄ‚îÄ place_N: { ... }
‚îú‚îÄ‚îÄ –°–ü–±:
‚îÇ   ‚îú‚îÄ‚îÄ place_1: { ... }
‚îÇ   ‚îî‚îÄ‚îÄ place_N: { ... }
‚îî‚îÄ‚îÄ –í–∞–ª–µ–Ω—Å–∏—è: { ... }
```

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ—Å—Ç–∞
```json
{
  "id": "0e87278a-9cce-495a-9b3f-66e4f440d032",
  "name": "–≥–∞–ø–≤–∞–ø–∞—ã–ø–≤–∞–æ—ã–≤",
  "address": "–ª–æ—ã–≤—Ä–∞–ª–æ—ã—Ä–∞–ª—ã–æ—Ä–∞",
  "working_hours": "234",
  "average_price": "545",
  "description": "–æ–ª—Ä–∞–æ—ã–ª–≤—Ä–∞—ã–æ–∞—Ä",
  "category_id": "13",
  "category_name": "–ö–ª—É–±—ã",
  "category_emoji": "üéâ",
  "website": null,
  "phone": "5677853",
  "photos": [
    {
      "url": "https://storage.googleapis.com/bucket/photos/photo_123.jpg",
      "uploadedAt": "2026-01-21T10:00:00Z"
    }
  ],
  "created_at": "2025-12-30T02:07:10.038Z",
  "updated_at": "2026-01-07T18:08:05.423Z"
}
```

## –õ–æ–∫–∞–ª—å–Ω—ã–µ JSON —Ñ–∞–π–ª—ã (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è)

### `data/cities.json`
```json
[
  "–ú–æ—Å–∫–≤–∞",
  "–°–ü–±",
  "–í–∞–ª–µ–Ω—Å–∏—è"
]
```

### `data/cities/{cityName}.json`
```json
{
  "name": "–í–∞–ª–µ–Ω—Å–∏—è",
  "createdAt": "2025-12-30T00:27:46.304Z",
  "places": [
    {
      "id": "0e87278a-9cce-495a-9b3f-66e4f440d032",
      "name": "–≥–∞–ø–≤–∞–ø–∞—ã–ø–≤–∞–æ—ã–≤",
      "address": "–ª–æ—ã–≤—Ä–∞–ª–æ—ã—Ä–∞–ª—ã–æ—Ä–∞",
      "photos": [
        {
          "url": "https://storage.googleapis.com/bucket/photos/photo_123.jpg",
          "uploadedAt": "2026-01-21T10:00:00Z"
        }
      ]
    }
  ]
}
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö

```javascript
// cityManager.getCityData("–ú–æ—Å–∫–≤–∞")
1. –ü–æ–ø—ã—Ç–∫–∞ Firebase ‚Üí –ø–æ–ª—É—á–∏—Ç—å –≥–æ—Ä–æ–¥ –∏–∑ database
2. –ï—Å–ª–∏ Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ ‚Üí —á–∏—Ç–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π JSON

// –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: Firebase > JSON
```

### –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

```javascript
// cityManager.saveCityData("–ú–æ—Å–∫–≤–∞", data)
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ data/cities/{cityName}.json
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Firebase database
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```
fileSyncManager –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:
‚îú‚îÄ‚îÄ data/categories.json     ‚Üí syncCategories()
‚îú‚îÄ‚îÄ data/cities.json         ‚Üí syncCities()
‚îú‚îÄ‚îÄ data/ads.json            ‚Üí syncAds()
‚îî‚îÄ‚îÄ data/cities/{city}.json  ‚Üí syncCityData(city)  ‚Üê NEW!

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤ Firebase
```

## –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ –º–µ–Ω–µ–¥–∂–µ—Ä–∞—Ö

### cityManager.js
```javascript
// bot.js –≤—ã–∑—ã–≤–∞–µ—Ç:
cityManager.setFirebaseDB(firebaseDatabase);

// –¢–µ–ø–µ—Ä—å getCityData() –∏ saveCityData() —Ä–∞–±–æ—Ç–∞—é—Ç —Å Firebase
```

### placeManager.js
```javascript
// bot.js –≤—ã–∑—ã–≤–∞–µ—Ç:
placeManager.firebaseDB = firebaseDatabase;

// –¢–µ–ø–µ—Ä—å getPlacesByCity() —á–∏—Ç–∞–µ—Ç –∏–∑ Firebase
```

## –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≥–æ—Ä–æ–¥–æ–≤

### fileSyncManager.js
```javascript
// –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ npm start

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:
1. data/categories.json
2. data/cities.json
3. data/ads.json
4. data/cities/–ú–æ—Å–∫–≤–∞.json
5. data/cities/–°–ü–±.json
6. data/cities/–í–∞–ª–µ–Ω—Å–∏—è.json
7. ... –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞

// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ —Ñ–∞–π–ª–∞ –≥–æ—Ä–æ–¥–∞ ‚Üí –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ Firebase
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - Firebase –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏  
‚úÖ **–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è** - JSON —Ñ–∞–π–ª—ã —Å–ª—É–∂–∞—Ç backup  
‚úÖ **–û—Ñ—Ñ–ª–∞–π–Ω –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞  
‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è  
‚úÖ **–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ  

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# 1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ —á–µ—Ä–µ–∑ –±–æ—Ç
/start ‚Üí –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ

# 2. –ú–µ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
# ‚úÖ data/cities/{cityName}.json
# ‚úÖ Firebase database

# 3. fileSyncManager –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ
# üìù –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: city:–ú–æ—Å–∫–≤–∞
# üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é –¥–∞–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞...
# ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –≤ Firebase

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Firebase Console:
# Database ‚Üí places ‚Üí –≥–æ—Ä–æ–¥ ‚Üí –º–µ—Å—Ç–∞

# 5. –í—ã–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
# –ú–µ—Å—Ç–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ JSON (fallback)
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

```
bot.js
  ‚îú‚îÄ‚îÄ cityManager.setFirebaseDB(firebaseDB)
  ‚îú‚îÄ‚îÄ placeManager.firebaseDB = firebaseDB
  ‚îî‚îÄ‚îÄ fileSyncManager.startWatching()
       ‚îú‚îÄ‚îÄ watches: data/cities.json
       ‚îú‚îÄ‚îÄ watches: data/cities/–ú–æ—Å–∫–≤–∞.json
       ‚îî‚îÄ‚îÄ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Üí syncCityData()
            ‚îî‚îÄ‚îÄ firebaseDB.saveCity()
            ‚îî‚îÄ‚îÄ firebaseDB.syncPlacesToFirebase()
```

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ JSON —Ñ–∞–π–ª–∞—Ö, –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ Firebase:

```bash
node migrate-to-firebase.js
```

–°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç:
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚úÖ –ì–æ—Ä–æ–¥–∞
- ‚úÖ –ú–µ—Å—Ç–∞ (–∏–∑ –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤)
- ‚úÖ –†–µ–∫–ª–∞–º—É

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–í—Å–µ —Ñ–æ—Ç–æ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Firebase Storage** (–Ω–µ –≤ JSON)
2. **URL —Ñ–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ JSON** (–¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏)
3. **–ì–æ—Ä–æ–¥–∞ –∏ –º–µ—Å—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è**
4. **JSON —Ñ–∞–π–ª—ã –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è** (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è)
5. **–ï—Å–ª–∏ Firebase –ø–∞–¥–∞–µ—Ç ‚Üí –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ JSON**
